#!/bin/sh


seed=0
length=1000
samples=1
truncate_length=1000
block_length=1
divide_num=2
mre_file=mre.dat
gn_file=gn.dat


display_usage() {
    cat << EOS
mregn-kl-div  - a program to analyze the Kullback-Leibler divergence that measures the distance between output of a mixture of RNN experts and test data.

Usage: mregn-kl-div [-s seed] [-n length] [-c samples] [-t truncate-length] [-b block-length] [-d divide-num] [-m mre-file] [-g gn-file] test-file ...
Usage: mregn-kl-div [-v] [-h]

Available options are:
-s seed
    \`seed' is the seed for the initialization of random number generator, which specifies a starting point for the random number sequence, and provides for restarting at the same point. If this option is omitted, the current system time is used.
-n length
    Iterations of the dynamics. Default is $length.
-c samples
    Number of samples. Default is $samples.
-t truncate-length
    \`truncate-length' is the time steps before evaluating output of the mixture of RNN experts in order to discard transient effects. Default is $truncate_length.
-b block-length
    Default is $block_length.
-d divide-num
    Default is $divide_num.
-m mre-file
    The file \`mre-file' being generated by mre-learn is used for the initialization of experts parameters. Default is \`$mre_file'.
-g gn-file
    The file \`gn-file' being generated by gn-learn is used for the initialization of a gating network parameters. Default is \`$gn_file'.

Program execution:
mregn-kl-div computes the Kullback-Leibler divergence between output of a mixture of RNN experts and test data. The parameters of the mixture of RNN experts are given by the mre-file (ex: mre.dat) and gn-file (ex: gn.dat) generated by mre-learn and gn-learn, respectively. To evaluate the Kullback-Leibler divergence, the output and data are discretized with respect to \`block-length' and \`divide-num'.
EOS
}


while getopts s:n:c:t:b:d:m:g:vh OPT
do
    case $OPT in
        s ) seed=${OPTARG};;
        n ) length=${OPTARG};;
        c ) samples=${OPTARG};;
        t ) truncate_length=${OPTARG};;
        b ) block_length=${OPTARG};;
        d ) divide_num=${OPTARG};;
        m ) mre_file=${OPTARG};;
        g ) gn_file=${OPTARG};;
        v ) echo "mregn-kl-div version 1.0"
            exit 0;;
        h ) display_usage
            exit 0;;
        \?) exit 1;;
    esac
done

shift `expr $OPTIND - 1`

for file in $@
do
    if [ ! -f "$file" ]; then
        echo "No such file or directory: $file"
        exit 1
    fi
done

if [ ! -f "$mre_file" ]; then
    echo "cannot find mre-file \`$mre_file'"
    exit 1
fi
if [ ! -f "$gn_file" ]; then
    echo "cannot find gn-file \`$gn_file'"
    exit 1
fi


python `dirname $0`/mregn_kl_div.py $seed $length $samples $truncate_length $block_length $divide_num $mre_file $gn_file $@

